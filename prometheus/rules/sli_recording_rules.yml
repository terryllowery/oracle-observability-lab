groups:
  - name: oracle_sli_calculations
    interval: 30s
    rules:
      # SLI 1: Availability (successful requests / total requests)
      - record: node:availability:ratio
        expr: |
          (
            sum by (node_id) (rate(oracle_requests_success_total[5m]))
          /
            sum by (node_id) (rate(oracle_requests_total[5m]))
          )
      # SLI 2: Response time p95
      - record: node:response_time:p95
        expr: |
          histogram_quantile(0.95, sum by (node_id, le) (rate(oracle_request_duration_seconds_bucket[5m])))
      # SLI 3: Response time p99
      - record: node:response_time:p99
        expr: |
          histogram_quantile(0.99, sum by (node_id, le) (rate(oracle_request_duration_seconds_bucket[5m])))
      # SLI 4: Error rate (for alerting)
      - record: node:error_rate:5m
        expr: |
          sum by (node_id) (rate(oracle_requests_failed_total[5m]))
          /
          sum by (node_id) (rate(oracle_requests_total[5m]))
